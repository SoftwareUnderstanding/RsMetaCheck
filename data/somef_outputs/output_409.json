{"somef_provenance": {"somef_version": "0.9.12", "somef_schema_version": "1.0.0", "date": "2025-11-17 13:19:26"}, "code_repository": [{"result": {"value": "https://github.com/ropensci/chopin", "type": "Url"}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"value": "https://github.com/ropensci/chopin", "type": "Url"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, {"result": {"value": "https://github.com/ropensci/chopin", "type": "Url"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "owner": [{"result": {"value": "ropensci", "type": "Organization"}, "confidence": 1, "technique": "GitHub_API"}], "date_created": [{"result": {"value": "2023-08-18T19:39:33Z", "type": "Date"}, "confidence": 1, "technique": "GitHub_API"}], "date_updated": [{"result": {"value": "2025-09-10T11:49:26Z", "type": "Date"}, "confidence": 1, "technique": "GitHub_API"}], "description": [{"result": {"value": "Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing http://doi.org/10.1016/j.softx.2025.102167", "type": "String"}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"value": "Geospatial data computation is parallelized by grid, hierarchy,\n    or raster files. Based on 'future' (Bengtsson, 2024 <doi:10.32614/CRAN.package.future>)\n    and 'mirai' (Gao et al., 2025 <doi:10.32614/CRAN.package.mirai>) parallel back-ends,\n    'terra' (Hijmans et al., 2025 <doi:10.32614/CRAN.package.terra>) and\n    'sf' (Pebesma et al., 2024 <doi:10.32614/CRAN.package.sf>)\n    functions as well as convenience functions in the package can be distributed\n    over multiple threads. The simplest way of parallelizing generic geospatial\n    computation is to start from par_pad_*() functions to par_grid(),\n    par_hierarchy(), or par_multirasters() functions. Virtually any functions\n    accepting classes in 'terra' or 'sf' packages can be used in the three\n    parallelization functions. A common raster-vector overlay operation\n    is provided as a function extract_at(), which uses\n    'exactextractr' (Baston, 2023 <doi:10.32614/CRAN.package.exactextractr>), with\n    options for kernel weights for summarizing raster values at vector geometries.\n    Other convenience functions for vector-vector operations including\n    simple areal interpolation (summarize_aw()) and summation of\n    exponentially decaying weights (summarize_sedc()) are also provided.", "type": "String", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, {"result": {"value": "Geospatial data computation is parallelized by grid, hierarchy, or raster files. Based on 'future' (Bengtsson, 2024 <doi:10.32614/CRAN.package.future>) and 'mirai' (Gao et al., 2025 <doi:10.32614/CRAN.package.mirai>) parallel back-ends, 'terra' (Hijmans et al., 2025 <doi:10.32614/CRAN.package.terra>) and 'sf' (Pebesma et al., 2024 <doi:10.32614/CRAN.package.sf>) functions as well as convenience functions in the package can be distributed over multiple threads. The simplest way of parallelizing generic geospatial computation is to start from par_pad_*() functions to par_grid(), par_hierarchy(), or par_multirasters() functions. Virtually any functions accepting classes in 'terra' or 'sf' packages can be used in the three parallelization functions. A common raster-vector overlay operation is provided as a function extract_at(), which uses 'exactextractr' (Baston, 2023 <doi:10.32614/CRAN.package.exactextractr>), with options for kernel weights for summarizing raster values at vector geometries. Other convenience functions for vector-vector operations including simple areal interpolation (summarize_aw()) and summation of exponentially decaying weights (summarize_sedc()) are also provided.", "type": "String"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}, {"result": {"type": "Text_excerpt", "value": "This package automates\n[parallelization](https://en.wikipedia.org/wiki/Parallel_computing) in\nspatial operations with `chopin` functions as well as\n[sf](https://github.com/r-spatial/sf)/[terra](https://github.com/rspatial/terra)\nfunctions. With [GDAL](https://gdal.org)-compatible files and database\ntables, `chopin` functions help to calculate spatial variables from\nvector and raster data with no external software requirements. All who\nneed to perform geospatial operations with large datasets may find this\npackage useful to accelerate the covariate calculation process for\nfurther analysis and modeling. We assume that users have basic knowledge\nof [geographic information system data\nmodels](https://r.geocompx.org/spatial-class), [coordinate systems and\ntransformations](https://doi.org/10.22224/gistbok/2023.1.2), [spatial\noperations](https://r.geocompx.org/spatial-operations), and\n[raster-vector overlay](https://r.geocompx.org/raster-vector).\n \n", "original_header": "Objective"}, "confidence": 0.981231587675338, "technique": "supervised_classification", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Text_excerpt", "value": "- `par_hierarchy`: parallelize over hierarchy coded in identifier fields\n  (for example, census blocks in each county in the US) \nFor grid partitioning, the entire study area will be divided into partly\noverlapped grids. We suggest two flowcharts to help which function to\nuse for parallel processing below. The upper flowchart is\nraster-oriented and the lower is vector-oriented. They are supplementary\nto each other. When a user follows the raster-oriented one, they might\nvisit the vector-oriented flowchart at each end of the raster-oriented\nflowchart. \nFrom version 0.9.5, `chopin` supports [H3](https://h3geo.org/) and\n[DGGRID](https://github.com/sahrk/DGGRID) in `par_pad_grid()`. Users can\nutilize each grid system with a proper resolution to improve the\nefficiency of spatial operations. \nProcessing functions accept\n[terra](https://github.com/rspatial/terra)/[sf](https://github.com/r-spatial/sf)\nclasses for spatial data. Raster-vector overlay is done with\n`exactextractr`. Three helper functions encapsulate multiple geospatial\ndata calculation steps over multiple CPU threads. \n", "original_header": "Overview"}, "confidence": 0.8783191694259925, "technique": "supervised_classification", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Text_excerpt", "value": "``` r\n# terra::nearest run\nsystem.time(\n  restr <- terra::nearest(x = terra::vect(pntst), y = terra::vect(rd1t))\n)\n#>    user  system elapsed \n#>   0.526   0.000   0.483\n\npnt_path <- file.path(tdir, \"pntst.gpkg\")\nsf::st_write(pntst, pnt_path)\n#> Writing layer `pntst' to data source `/tmp/Rtmphl1eXq/pntst.gpkg' using driver `GPKG'\n#> Writing 5000 features with 1 fields and geometry type Point.\n\n# we use four threads that were configured above\nsystem.time(\n  resd <-\n    chopin::par_grid(\n      grids = nccompreg,\n      fun_dist = nearest,\n      x = pnt_path,\n      y = ncrd1_path,\n      pad_y = TRUE\n    )\n)\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 1 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 2 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 3 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 4 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 5 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 6 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 7 is successfully dispatched.\n#> \n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Input is a character. Trying to read with terra .\n#> \u2139 Task at CGRIDID: 8 is successfully dispatched.\n#>    user  system elapsed \n#>   1.306   0.578   2.691\n``` \nUsers should be mindful of caveats in the parallelization of nearest\nfeature search, which may result in no or excess distance depending on\nthe distribution of the target dataset to which the nearest feature is\nsearched. For example, when one wants to calculate the nearest\ninterstate from rural homes with fine grids, some grids may have no\ninterstates then homes in such grids will not get any distance to the\nnearest interstate. Such problems can be avoided by choosing `nx`, `ny`,\nand `padding` values in `par_pad_grid()` meticulously.\n \n", "original_header": "Parallelization of a generic geospatial operation"}, "confidence": 0.8986400530128409, "technique": "supervised_classification", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}], "name": [{"result": {"value": "chopin", "type": "String"}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"value": "chopin: Spatial Parallel Computing by Hierarchical Data Partitioning", "type": "String"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "full_name": [{"result": {"value": "ropensci/chopin", "type": "String"}, "confidence": 1, "technique": "GitHub_API"}], "issue_tracker": [{"result": {"value": "https://api.github.com/repos/ropensci/chopin/issues", "type": "Url"}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"value": "https://github.com/ropensci/chopin/issues", "type": "Url"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, {"result": {"value": "https://github.com/ropensci/chopin/issues", "type": "Url"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "forks_url": [{"result": {"value": "https://api.github.com/repos/ropensci/chopin/forks", "type": "Url"}, "confidence": 1, "technique": "GitHub_API"}], "stargazers_count": [{"result": {"value": 26, "type": "Number"}, "confidence": 1, "technique": "GitHub_API"}], "forks_count": [{"result": {"value": 3, "type": "Number"}, "confidence": 1, "technique": "GitHub_API"}], "homepage": [{"result": {"value": "https://docs.ropensci.org/chopin/", "type": "Url"}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"value": "https://docs.ropensci.org/chopin/", "type": "Url"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}], "download_url": [{"result": {"value": "https://github.com/ropensci/chopin/releases", "type": "Url"}, "confidence": 1, "technique": "GitHub_API"}], "programming_languages": [{"result": {"value": "R", "name": "R", "type": "Programming_language", "size": 324415}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"value": "Shell", "name": "Shell", "type": "Programming_language", "size": 7432}, "confidence": 1, "technique": "GitHub_API"}, {"result": {"name": "R", "value": "R", "type": "Programming_language", "url": "https://r-project.org"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "citation": [{"result": {"value": "cff-version: 1.2.0\ntitle: chopin\nmessage: >-\n  If you use this software, please cite it using the\n  metadata from this file.\ntype: software\nauthors:\n  - given-names: Insang\n    family-names: Song\n    email: geoissong@gmail.com\n    affiliation: 'Seoul National University'\n    orcid: 'https://orcid.org/0000-0001-8732-3256'\n  - given-names: Kyle P.\n    family-names: Messier\n    email: kyle.messier@nih.gov\n    affiliation: NIEHS\n    orcid: 'https://orcid.org/0000-0001-9508-9623'\nrepository-code: 'https://github.com/ropensci/chopin'\nkeywords:\n  - spatial data\n  - parallel processing\nlicense: MIT\n", "type": "File_dump", "author": [{"type": "Agent", "name": "Insang Song", "family_name": "Song", "given_name": "Insang", "url": "https://orcid.org/0000-0001-8732-3256"}, {"type": "Agent", "name": "Kyle P. Messier", "family_name": "Messier", "given_name": "Kyle P.", "url": "https://orcid.org/0000-0001-9508-9623"}], "title": "chopin", "format": "cff"}, "confidence": 1, "technique": "file_exploration", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/CITATION.cff"}], "license": [{"result": {"value": "# MIT License\n\nCopyright (c) 2024 chopin authors\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n", "type": "File_dump", "name": "MIT License", "spdx_id": "MIT"}, "confidence": 1, "technique": "file_exploration", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/LICENSE.md"}, {"result": {"value": "MIT + file LICENSE", "type": "String", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, {"result": {"value": "https://spdx.org/licenses/MIT", "type": "License", "identifier": "https://spdx.org/licenses/https://spdx.org/licenses/MIT", "spdx_id": "https://spdx.org/licenses/MIT"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "readme_url": [{"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd", "type": "Url"}, "confidence": 1, "technique": "file_exploration"}, {"result": {"value": "https://github.com/ropensci/chopin/blob/main/README.md", "type": "String"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}, {"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/README.md", "type": "Url"}, "confidence": 1, "technique": "file_exploration"}], "has_build_file": [{"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION", "type": "Url", "format": "description"}, "confidence": 1, "technique": "file_exploration", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}], "has_package_file": [{"result": {"value": "DESCRIPTION", "type": "Url", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}], "package_id": [{"result": {"value": "chopin", "type": "String", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}], "version": [{"result": {"value": "0.9.9", "type": "String", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, {"result": {"value": "0.9.9", "type": "String"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "authors": [{"result": {"value": [{"value": "Insang Song", "email": ""}], "type": "Agent", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/DESCRIPTION"}, {"result": {"value": "Insang Song", "type": "String", "email": "geoissong@gmail.com", "identifier": "https://orcid.org/0000-0001-8732-3256"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}, {"result": {"value": "Kyle Messier", "type": "String", "identifier": "https://orcid.org/0000-0001-9508-9623"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "continuous_integration": [{"result": {"value": "https://github.com/ropensci/chopin/actions/workflows/check-standard.yaml", "type": "Url"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "development_status": [{"result": {"value": "https://lifecycle.r-lib.org/articles/stages.html#stable", "type": "String"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "identifier": [{"result": {"value": "chopin", "type": "String"}, "confidence": 1, "technique": "code_parser", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/codemeta.json"}], "has_script_file": [{"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/containers/calc_highthroughput.sh", "type": "Url"}, "confidence": 1, "technique": "file_exploration"}, {"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/containers/apptainer_build.sh", "type": "Url"}, "confidence": 1, "technique": "file_exploration"}, {"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/tools/slurm_test/run_on_apptainer.sh", "type": "Url"}, "confidence": 1, "technique": "file_exploration"}, {"result": {"value": "https://raw.githubusercontent.com/ropensci/chopin/main/tools/slurm_test/run_slurm.sh", "type": "Url"}, "confidence": 1, "technique": "file_exploration"}], "contributing_guidelines": [{"result": {"value": "# Contributing to `chopin`\nThis outlines how to propose a change to `chopin`.\n\n\n## Fixing typos\n\nYou can fix typos, spelling mistakes, or grammatical errors in the documentation directly using the GitHub web interface, as long as the changes are made in the _source_ file. \nThis generally means you'll need to edit [roxygen2 comments](https://roxygen2.r-lib.org/articles/roxygen2.html) in an `.R`, not a `.Rd` file. \nYou can find the `.R` file that generates the `.Rd` by reading the comment in the first line.\n\n## Bigger changes\n\nIf you want to make a bigger change, it's a good idea to first file an issue and make sure someone from the team agrees that it\u2019s needed. \nIf you\u2019ve found a bug, please file an issue that illustrates the bug with a minimal \n[reprex](https://www.tidyverse.org/help/#reprex) (this will also help you write a unit test, if needed).\nSee tidyverse team's guide on [how to create a great issue](https://code-review.tidyverse.org/issues/) for more advice.\nWhen adding a new function to the package, always add working examples of the new function in roxygen2 documentation under `#' @examples`.\n\n### Pull request process\n\n*   Fork the package and clone onto your computer. If you haven't done this before, we recommend using `usethis::create_from_github(\"NIEHS/chopin\", fork = TRUE)`.\n\n*   Install all development dependencies with `devtools::install_dev_deps()`, and then make sure the package passes R CMD check by running `devtools::check()`. \n    If R CMD check doesn't pass cleanly, it's a good idea to ask for help before continuing. \n*   Create a Git branch for your pull request (PR). We recommend using `usethis::pr_init(\"brief-description-of-change\")`.\n\n*   Make your changes, commit to git, and then create a PR by running `usethis::pr_push()`, and following the prompts in your browser.\n    The title of your PR should briefly describe the change.\n    The body of your PR should contain `Fixes #issue-number`.\n\n*  For user-facing changes, add a bullet to the top of `NEWS.md` (i.e. just below the first header).\n\n### Code style\n\n*  Please abide by 80-character line rules (as default settings in `lintr`)\n\n*  We use [roxygen2](https://cran.r-project.org/package=roxygen2), with [Markdown syntax](https://cran.r-project.org/web/packages/roxygen2/vignettes/rd-formatting.html), for documentation.  \n\n*  We use [testthat](https://cran.r-project.org/package=testthat) for unit tests. \n   Contributions with test cases included are easier to accept.  \n\n## Code of Conduct\n\nPlease note that the chopin project is released with a\n[Contributor Code of Conduct](CODE_OF_CONDUCT.md). By contributing to this\nproject you agree to abide by its terms.\n", "type": "File_dump"}, "confidence": 1, "technique": "file_exploration", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/.github/CONTRIBUTING.md"}], "installation": [{"result": {"value": "We provide two flowcharts to help users choose the right function for\nparallel processing. The raster-oriented flowchart is for users who want\nto start with raster data, and the vector-oriented flowchart is for\nusers with large vector data.\n\nIn **raster-oriented selection**, we suggest four factors to consider:\n\n- Number of raster files: for multiple files, `par_multirasters` is\n  recommended. When there are multiple rasters that share the same\n  extent and resolution, consider stacking the rasters into multilayer\n  SpatRaster object by calling `terra::rast(filenames)`.\n- Raster resolution: We suggest 100 meters as a threshold. Rasters with\n  resolution coarser than 100 meters and a few layers would be better\n  for the direct call of `exactextractr::exact_extract()`.\n- Raster extent: Using `SpatRaster` in `exactextractr::exact_extract()`\n  is often minimally affected by the raster extent.\n- Memory size: `max_cells_in_memory` argument value of\n  `exactextractr::exact_extract()`, raster resolution, and the number of\n  layers in `SpatRaster` are multiplicatively related to the memory\n  usage.\n\n![](man/figures/README-flowchart-raster.png)\n\nFor **vector-oriented selection**, we suggest three factors to consider:\n\n- Number of features: When the number of features is over 100,000,\n  consider using `par_grid` or `par_hierarchy` to split the data into\n  smaller chunks.\n- Hierarchical structure: If the data has a hierarchical structure,\n  consider using `par_hierarchy` to parallelize the operation.\n- Data grouping: If the data needs to be grouped in similar sizes,\n  consider using `par_pad_balanced` or `par_pad_grid` with\n  `mode = \"grid_quantile\"`.\n\n![](man/figures/README-flowchart-vector.png)\n", "type": "Text_excerpt", "original_header": "Function selection guide", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Overview"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "From version 0.9.4, `chopin` is available on CRAN.\n\n``` r\ninstall.packages(\"chopin\")\n```\n\n`chopin` can be installed using `remotes::install_github` (also possible\nwith `pak::pak` or `devtools::install_github`).\n\n``` r\nrlang::check_installed(\"remotes\")\nremotes::install_github(\"ropensci/chopin\")\n```\n\nor you can also set `repos` in `install.packages()` as ROpenSci\nrepository:\n\n``` r\n# More recent version is available rOpenSci universe\ninstall.packages(\"chopin\", repos = \"https://ropensci.r-universe.dev\")\n```\n", "type": "Text_excerpt", "original_header": "Installation", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}], "usage": [{"result": {"value": "Examples will navigate `par_grid`, `par_hierarchy`, and\n`par_multirasters` functions in `chopin` to parallelize geospatial\noperations.\n\n``` r\n# check and install packages to run examples\npkgs <- c(\"chopin\", \"dplyr\", \"sf\", \"terra\", \"future\", \"future.mirai\", \"mirai\", \"h3r\", \"dggridR\")\n# install packages if anything is unavailable\nrlang::check_installed(pkgs)\n\nlibrary(chopin)\nlibrary(dplyr)\n#> \n#> Attaching package: 'dplyr'\n#> The following objects are masked from 'package:stats':\n#> \n#>     filter, lag\n#> The following objects are masked from 'package:base':\n#> \n#>     intersect, setdiff, setequal, union\nlibrary(sf)\n#> Linking to GEOS 3.12.2, GDAL 3.11.3, PROJ 9.4.1; sf_use_s2() is TRUE\nlibrary(terra)\n#> terra 1.8.60\nlibrary(future)\nlibrary(future.mirai)\nlibrary(mirai)\nlibrary(h3r)\n#> Loading required package: h3lib\n#> \n#> Attaching package: 'h3r'\n#> The following object is masked from 'package:terra':\n#> \n#>     gridDistance\nlibrary(dggridR)\n\n# disable spherical geometries\nsf::sf_use_s2(FALSE)\n#> Spherical geometry (s2) switched off\n\n# parallelization-safe random number generator\nset.seed(2024, kind = \"L'Ecuyer-CMRG\")\n```\n", "type": "Text_excerpt", "original_header": "Examples", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "Please refer to a small example below for extracting mean altitude\nvalues at circular point buffers and census tracts in North Carolina.\nBefore running code chunks below, set the cloned `chopin` repository as\nyour working directory with `setwd()`\n\n``` r\nncpoly <- system.file(\"shape/nc.shp\", package = \"sf\")\nncsf <- sf::read_sf(ncpoly)\nncsf <- sf::st_transform(ncsf, \"EPSG:5070\")\nplot(sf::st_geometry(ncsf))\n```\n\n<img src=\"man/figures/README-read-nc-1.png\" width=\"100%\" />\n", "type": "Text_excerpt", "original_header": "`par_grid`: parallelize over artificial grid polygons", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "Ten thousands random point locations were generated inside the counties\nof North Carolina.\n\n``` r\nncpoints <- sf::st_sample(ncsf, 1e4)\nncpoints <- sf::st_as_sf(ncpoints)\nncpoints$pid <- sprintf(\"PID-%05d\", seq(1, 1e4))\nplot(sf::st_geometry(ncpoints))\n```\n\n<img src=\"man/figures/README-gen-ncpoints-1.png\" width=\"100%\" />\n", "type": "Text_excerpt", "original_header": "Generate random points in NC", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples", "`par_grid`: parallelize over artificial grid polygons"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "We use an elevation dataset with and a moderate spatial resolution\n(approximately 400 meters or 0.25 miles).\n\n``` r\n# data preparation\nsrtm_path <- file.path(tempdir(check = TRUE), \"nc_srtm15_otm.tif\")\nsrtm_url <-\n  paste0(\n    \"https://raw.githubusercontent.com/\",\n    \"ropensci/chopin/refs/heads/main/\",\n    \"tests/testdata/nc_srtm15_otm.tif\"\n  )\ndownload.file(srtm_url, srtm_path, mode = \"wb\")\n\n# terra SpatRaster objects are wrapped when exported to rds file\nsrtm_ras <- terra::rast(srtm_path)\nterra::crs(srtm_ras) <- \"EPSG:5070\"\nsrtm_ras\n#> class       : SpatRaster \n#> size        : 1534, 2281, 1  (nrow, ncol, nlyr)\n#> resolution  : 391.5026, 391.5026  (x, y)\n#> extent      : 1012872, 1905890, 1219961, 1820526  (xmin, xmax, ymin, ymax)\n#> coord. ref. : NAD83 / Conus Albers (EPSG:5070) \n#> source      : nc_srtm15_otm.tif \n#> name        :    srtm15 \n#> min value   : -3589.291 \n#> max value   :  1946.400\nterra::plot(srtm_ras)\n```\n\n<img src=\"man/figures/README-load-srtm-1.png\" width=\"100%\" />\n\n``` r\n# ncpoints_tr <- terra::vect(ncpoints)\nsystem.time(\n  ncpoints_srtm <-\n    chopin::extract_at(\n      x = srtm_ras,\n      y = ncpoints,\n      id = \"pid\",\n      mode = \"buffer\",\n      radius = 1e4L  # 10,000 meters (10 km)\n    )\n)\n#>    user  system elapsed \n#>   5.769   0.170   5.366\n```\n", "type": "Text_excerpt", "original_header": "Target raster dataset: <a href=\"https://www.usgs.gov/centers/eros/science/usgs-eros-archive-digital-elevation-shuttle-radar-topography-mission-srtm-1\">Shuttle Radar Topography Mission</a>", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples", "`par_grid`: parallelize over artificial grid polygons"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "`chopin::par_pad_grid()` takes a spatial dataset to generate regular\ngrid polygons with `nx` and `ny` arguments with padding. Users will have\nboth overlapping (by the degree of `radius`) and non-overlapping grids,\nboth of which will be utilized to split locations and target datasets\ninto sub-datasets for efficient processing.\n\n``` r\ncompregions <-\n  chopin::par_pad_grid(\n    ncpoints,\n    mode = \"grid\",\n    nx = 2L,\n    ny = 2L,\n    padding = 1e4L\n  )\n#> Switch sf class to terra...\n#> Switch terra class to sf...\n```\n\n`compregions` is a list object with two elements named `original`\n(non-overlapping grid polygons) and `padded` (overlapping by `padding`).\nThe figures below illustrate the grid polygons with and without\noverlaps.\n\n``` r\nnames(compregions)\n#> [1] \"original\" \"padded\"\n\noldpar <- par()\npar(mfrow = c(2, 1))\nterra::plot(\n  terra::vect(compregions$original),\n  main = \"Original grids\"\n)\nterra::plot(\n  terra::vect(compregions$padded),\n  main = \"Padded grids\"\n)\n```\n\n<img src=\"man/figures/README-compare-compregions-1.png\" width=\"100%\" />\n\nFrom 0.9.5, H3 and DGGRID systems are supported in `par_pad_grid()`:\n\n``` r\nsuppressWarnings(\n  nc_comp_region_h3 <-\n    par_pad_grid(\n      ncpoints,\n      mode = \"h3\",\n      res = 3L,\n      padding = 10000\n    )\n)\n#> Input sf object should be in WGS84 (EPSG:4326) CRS.\n#> Non-polygon geometries detected. Attempt to convert to polygons using concave\n#> hull.\n#> although coordinates are longitude/latitude, st_union assumes that they are\n#> planar\n#> \n#> although coordinates are longitude/latitude, st_intersects assumes that they\n#> are planar\n#> \n#> Switch sf class to terra...\n#> Switch terra class to sf...\npar(mfrow = c(2, 1))\nplot(nc_comp_region_h3$original$geometry, main = \"H3 grid (lv.3)\")\nplot(nc_comp_region_h3$padded$geometry, main = \"H3 padded grid (lv.3)\")\n```\n\n<img src=\"man/figures/README-h3-grid-1.png\" width=\"100%\" />\n\n``` r\npar(oldpar)\n#> Warning in par(oldpar): graphical parameter \"cin\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"cra\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"csi\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"cxy\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"din\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"page\" cannot be set\n```\n\n``` r\nnc_comp_region_dggrid <-\n  par_pad_grid(\n    ncpoints,\n    mode = \"dggrid\",\n    res = 7L,\n    padding = 10000\n  )\n#> Input sf object should be in WGS84 (EPSG:4326) CRS.\n#> Switch sf class to terra...\n#> Switch terra class to sf...\npar(mfrow = c(2, 1))\nplot(nc_comp_region_dggrid$original$geometry, main = \"DGGRID (lv.7)\")\nplot(nc_comp_region_dggrid$padded$geometry, main = \"Padded DGGRID (lv.7)\")\n```\n\n<img src=\"man/figures/README-dggrid-grid-1.png\" width=\"100%\" />\n\n``` r\npar(oldpar)\n#> Warning in par(oldpar): graphical parameter \"cin\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"cra\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"csi\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"cxy\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"din\" cannot be set\n#> Warning in par(oldpar): graphical parameter \"page\" cannot be set\n```\n", "type": "Text_excerpt", "original_header": "Generate regular grid computational regions", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples", "`par_grid`: parallelize over artificial grid polygons"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "Using the grid polygons, we distribute the task of averaging elevations\nat 10,000 circular buffer polygons, which are generated from the random\nlocations, with 10 kilometers radius by `chopin::par_grid()`. Users\nalways need to **register** multiple CPU threads (logical cores) for\nparallelization. `chopin::par_*()` functions are flexible in terms of\nsupporting generic spatial operations in `sf` and `terra`, especially\nwhere two datasets are involved. Users can inject generic functions\u2019\narguments (parameters) by writing them in the ellipsis (`...`)\narguments, as demonstrated below:\n\n``` r\nfuture::plan(future.mirai::mirai_multisession, workers = 4L)\n\nsystem.time(\n  ncpoints_srtm_mthr <-\n    par_grid(\n      grids = compregions,\n      fun_dist = extract_at,\n      x = srtm_ras,\n      y = ncpoints,\n      id = \"pid\",\n      radius = 1e4L,\n      .standalone = FALSE\n    )\n)\n#> \u2139 SpatRaster class input is detected.\n#> Attempt to track the data source file path...\n#> \u2139 Input is not a character.\n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Task at CGRIDID: 1 is successfully dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Task at CGRIDID: 2 is successfully dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Task at CGRIDID: 3 is successfully dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Task at CGRIDID: 4 is successfully dispatched.\n#>    user  system elapsed \n#>   1.858   0.343   8.947\n\nncpoints_srtm <-\n  extract_at(\n    x = srtm_ras,\n    y = ncpoints,\n    id = \"pid\",\n    radius = 1e4L\n  )\n\nfuture::plan(future::sequential)\nmirai::daemons(0L)\n#> [1] 0\n```\n\n``` r\ncolnames(ncpoints_srtm_mthr)[2] <- \"mean_par\"\nncpoints_compar <- merge(ncpoints_srtm, ncpoints_srtm_mthr)\n# Are the calculations equal?\nall.equal(ncpoints_compar$mean, ncpoints_compar$mean_par)\n#> [1] TRUE\n```\n\n``` r\nncpoints_s <-\n  merge(ncpoints, ncpoints_srtm)\nncpoints_m <-\n  merge(ncpoints, ncpoints_srtm_mthr)\n\nplot(ncpoints_s[, \"mean\"], main = \"Single-thread\", pch = 19, cex = 0.33)\n```\n\n<img src=\"man/figures/README-plot results-1.png\" width=\"100%\" />\n\n``` r\nplot(ncpoints_m[, \"mean_par\"], main = \"Multi-thread\", pch = 19, cex = 0.33)\n```\n\n<img src=\"man/figures/README-plot results-2.png\" width=\"100%\" />\n\nThe same workflow operates on `mirai` dispatchers.\n\n``` r\nmirai::daemons(4L)\n#> [1] 4\n\nsystem.time(\n  ncpoints_srtm_mthr <-\n    par_grid_mirai(\n      grids = compregions,\n      fun_dist = extract_at,\n      x = srtm_ras,\n      y = ncpoints,\n      id = \"pid\",\n      radius = 1e4L,\n      .standalone = FALSE\n    )\n)\n#> \u2139 SpatRaster class input is detected.\n#> Attempt to track the data source file path...\n#> \u2139 Input is not a character.\n#>    user  system elapsed \n#>   0.931   0.242   8.156\n\n# remove mirai::daemons\nmirai::daemons(0L)\n#> [1] 0\n```\n", "type": "Text_excerpt", "original_header": "Parallel processing", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples", "`par_grid`: parallelize over artificial grid polygons"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "We usually have nested/exhaustive hierarchies in real-world datasets.\nFor example, land is organized by administrative/jurisdictional borders\nwhere multiple levels exist. In the U.S. context, a state consists of\nseveral counties, counties are split into census tracts, and they have a\ngroup of block groups. `chopin::par_hierarchy()` leverages such\nhierarchies to parallelize geospatial operations, which means that a\ngroup of lower-level geographic units in a higher-level geography is\nassigned to a process. A demonstration below shows that census tracts\nare grouped by their counties then each county will be processed in a\nCPU thread.\n", "type": "Text_excerpt", "original_header": "`chopin::par_hierarchy()`: parallelize geospatial computations using intrinsic data hierarchy", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "``` r\n# nc_hierarchy.gpkg includes two layers: county and tracts\nhierarchy_path <- file.path(tempdir(check = TRUE), \"nc_hierarchy.gpkg\")\nhierarchy_url <-\n  paste0(\n    \"https://raw.githubusercontent.com/\",\n    \"ropensci/chopin/refs/heads/main/\",\n    \"tests/testdata/nc_hierarchy.gpkg\"\n  )\ndownload.file(hierarchy_url, hierarchy_path, mode = \"wb\")\n\nnc_data <- hierarchy_path\nnc_county <- sf::st_read(nc_data, layer = \"county\")\n#> Reading layer `county' from data source `/tmp/Rtmphl1eXq/nc_hierarchy.gpkg' using driver `GPKG'\n#> Simple feature collection with 100 features and 1 field\n#> Geometry type: POLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176\n#> Projected CRS: NAD83 / Conus Albers\nnc_tracts <- sf::st_read(nc_data, layer = \"tracts\")\n#> Reading layer `tracts' from data source `/tmp/Rtmphl1eXq/nc_hierarchy.gpkg' using driver `GPKG'\n#> Simple feature collection with 2672 features and 1 field\n#> Geometry type: MULTIPOLYGON\n#> Dimension:     XY\n#> Bounding box:  xmin: 1054155 ymin: 1341756 xmax: 1838923 ymax: 1690176\n#> Projected CRS: NAD83 / Conus Albers\n\n# reproject to Conus Albers Equal Area\nnc_county <- sf::st_transform(nc_county, \"EPSG:5070\")\nnc_tracts <- sf::st_transform(nc_tracts, \"EPSG:5070\")\nnc_tracts$COUNTY <- substr(nc_tracts$GEOID, 1, 5)\n```\n", "type": "Text_excerpt", "original_header": "Read data", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples", "`chopin::par_hierarchy()`: parallelize geospatial computations using intrinsic data hierarchy"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "``` r\nfuture::plan(future.mirai::mirai_multisession, workers = 4L)\n\n# single-thread\nsystem.time(\n  nc_elev_tr_single <-\n    chopin::extract_at(\n      x = srtm_ras,\n      y = nc_tracts,\n      id = \"GEOID\"\n    )\n)\n#>    user  system elapsed \n#>   0.715   0.005   4.220\n\n# hierarchical parallelization\nsystem.time(\n  nc_elev_tr_distr <-\n    chopin::par_hierarchy(\n      regions = nc_county, # higher level geometry\n      regions_id = \"GEOID\", # higher level unique id\n      fun_dist = extract_at,\n      x = srtm_ras,\n      y = nc_tracts, # lower level geometry\n      id = \"GEOID\", # lower level unique id\n      func = \"mean\"\n    )\n)\n#> \u2139 SpatRaster class input is detected.\n#> Attempt to track the data source file path...\n#> \u2139 Input is not a character.\n#> \u2139 GEOID is used to stratify the process.\n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37037 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37001 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37057 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37069 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37155 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37109 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37027 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37063 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37145 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37115 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37151 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37131 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37013 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37159 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37051 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37153 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37093 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37025 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37029 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37169 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37031 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37005 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37139 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37193 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37003 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37083 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37163 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37189 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37173 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37011 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37045 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37125 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37067 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37077 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37185 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37137 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37033 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37107 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37075 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37073 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37161 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37187 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37007 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37135 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37049 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37195 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37061 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37087 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37081 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37099 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37097 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37091 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37149 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37165 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37085 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37105 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37017 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37039 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37035 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37177 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37113 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37143 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37095 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37071 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37101 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37015 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37167 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37079 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37129 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37147 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37141 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37179 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37121 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37133 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37065 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37119 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37199 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37197 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37023 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37191 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37059 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37111 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37183 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37053 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37103 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37041 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37021 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37157 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37117 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37089 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37127 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37009 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37019 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37123 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37181 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37175 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37171 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37043 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37055 is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at 37047 is dispatched.\n#>    user  system elapsed \n#>   2.143   0.999   9.337\n```\n", "type": "Text_excerpt", "original_header": "Extract average SRTM elevations by single and multiple threads", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples", "`chopin::par_hierarchy()`: parallelize geospatial computations using intrinsic data hierarchy"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"value": "There is a common case of having a large group of raster files at which\nthe same operation should be performed. `chopin::par_multirasters()` is\nfor such cases. An example below demonstrates where we have five\nelevation raster files to calculate the average elevation at counties in\nNorth Carolina.\n\n``` r\n# nccnty <- sf::st_read(nc_data, layer = \"county\")\nncelev <- terra::rast(srtm_path)\nterra::crs(ncelev) <- \"EPSG:5070\"\nnames(ncelev) <- c(\"srtm15\")\ntdir <- tempdir(check = TRUE)\n\nterra::writeRaster(ncelev, file.path(tdir, \"test1.tif\"), overwrite = TRUE)\nterra::writeRaster(ncelev, file.path(tdir, \"test2.tif\"), overwrite = TRUE)\nterra::writeRaster(ncelev, file.path(tdir, \"test3.tif\"), overwrite = TRUE)\nterra::writeRaster(ncelev, file.path(tdir, \"test4.tif\"), overwrite = TRUE)\nterra::writeRaster(ncelev, file.path(tdir, \"test5.tif\"), overwrite = TRUE)\n\n# check if the raster files were exported as expected\ntestfiles <- list.files(tdir, pattern = \"*.tif$\", full.names = TRUE)\ntestfiles\n#> [1] \"/tmp/Rtmphl1eXq/nc_srtm15_otm.tif\" \"/tmp/Rtmphl1eXq/test1.tif\"        \n#> [3] \"/tmp/Rtmphl1eXq/test2.tif\"         \"/tmp/Rtmphl1eXq/test3.tif\"        \n#> [5] \"/tmp/Rtmphl1eXq/test4.tif\"         \"/tmp/Rtmphl1eXq/test5.tif\"\n```\n\n``` r\nsystem.time(\n  res <-\n    chopin::par_multirasters(\n      filenames = testfiles,\n      fun_dist = extract_at,\n      x = ncelev,\n      y = nc_county,\n      id = \"GEOID\",\n      func = \"mean\"\n    )\n)\n#> \u2139 Input is not a character.\n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at /tmp/Rtmphl1eXq/nc_srtm15_otm.tif is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at /tmp/Rtmphl1eXq/test1.tif is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at /tmp/Rtmphl1eXq/test2.tif is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at /tmp/Rtmphl1eXq/test3.tif is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at /tmp/Rtmphl1eXq/test4.tif is dispatched.\n#> \n#> Input is a character. Attempt to read it with terra::rast...\n#> \u2139 Your input function at /tmp/Rtmphl1eXq/test5.tif is dispatched.\n#>    user  system elapsed \n#>   1.674   0.609   3.072\nknitr::kable(head(res))\n```\n\n|      mean | base_raster                       |\n|----------:|:----------------------------------|\n| 136.80203 | /tmp/Rtmphl1eXq/nc_srtm15_otm.tif |\n| 189.76170 | /tmp/Rtmphl1eXq/nc_srtm15_otm.tif |\n| 231.16968 | /tmp/Rtmphl1eXq/nc_srtm15_otm.tif |\n|  98.03845 | /tmp/Rtmphl1eXq/nc_srtm15_otm.tif |\n|  41.23463 | /tmp/Rtmphl1eXq/nc_srtm15_otm.tif |\n| 270.96933 | /tmp/Rtmphl1eXq/nc_srtm15_otm.tif |\n\n``` r\n\n# remove temporary raster files\nfile.remove(testfiles)\n#> [1] TRUE TRUE TRUE TRUE TRUE TRUE\n```\n\n\n", "type": "Text_excerpt", "original_header": "`par_multirasters()`: parallelize over multiple rasters", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Examples"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}], "run": [{"result": {"value": "Parallelization may underperform when the datasets are too small to take\nadvantage of divide-and-compute approach, where parallelization overhead\nis involved. Overhead here refers to the required amount of\ncomputational resources for transferring objects to multiple processes.\nSince the demonstrations above use quite small datasets, the advantage\nof parallelization was not as noticeable as it was expected. Should a\nlarge amount of data (spatial/temporal resolution or number of files,\nfor example) be processed, users could find the efficiency of this\npackage. A vignette in this package demonstrates use cases extracting\nvarious climate/weather datasets.\n", "type": "Text_excerpt", "original_header": "Why parallelization is slower than the ordinary function run?", "parent_header": ["Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing <a href=\"https://docs.ropensci.org/chopin/\"><img src=\"man/figures/logo.svg\" align=\"right\" height=\"210\" alt=\"overlapping irregular grid polygons filled with orange, green, and teal\" /></a>", "Caveats"]}, "confidence": 1, "technique": "header_analysis", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}], "full_title": [{"result": {"type": "String", "value": "Computation of Spatial Data by Hierarchical and Objective Partitioning of Inputs for Parallel Processing"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}], "logo": [{"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/logo.svg"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}], "images": [{"result": {"type": "Url", "value": "https://github.com/ropensci/chopin/raw/refs/heads/artifacts/actions/workflows/test-coverage-local.yaml/coverage.svg"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-flowchart-raster.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-flowchart-vector.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-read-nc-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-gen-ncpoints-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-load-srtm-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-compare-compregions-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-h3-grid-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-dggrid-grid-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-plot results-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-plot results-2.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}, {"result": {"type": "Url", "value": "https://raw.githubusercontent.com/ropensci/chopin/main/man/figures/README-map-all-1.png"}, "confidence": 1, "technique": "regular_expression", "source": "https://raw.githubusercontent.com/ropensci/chopin/main/README.Rmd"}]}